{% extends "base.html" %}
{% load static %}

{% block title %}VOXLIBER - ë‚´ ì„œì¬{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/mypage/my_library.css' %}">
{% endblock %}

{% block content %}
<div class="library-container">
  <!-- í—¤ë” -->
  <div class="library-header">
    <h1 class="library-title">ë‚´ ì„œì¬</h1>
    <p class="library-subtitle">ë‚˜ë§Œì˜ ë…ì„œ ê¸°ë¡ì„ í™•ì¸í•˜ì„¸ìš”</p>
  </div>

  <!-- í†µê³„ ì¹´ë“œ -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-label">ì „ì²´ ì±…</div>
      <div class="stat-value">{{ stats.total }}</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">ì½ëŠ” ì¤‘</div>
      <div class="stat-value">{{ stats.reading }}</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">ì™„ë…</div>
      <div class="stat-value">{{ stats.completed }}</div>
    </div>
  </div>

  <!-- í•„í„° íƒ­ -->
  <div class="filter-tabs">
    <a href="?status=all" class="filter-tab {% if filter_status == 'all' %}active{% endif %}">ì „ì²´</a>
    <a href="?status=reading" class="filter-tab {% if filter_status == 'reading' %}active{% endif %}">ì½ëŠ” ì¤‘</a>
    <a href="?status=completed" class="filter-tab {% if filter_status == 'completed' %}active{% endif %}">ì™„ë…</a>
  </div>

  <!-- ì±… ëª©ë¡ -->
  {% if reading_progress_list %}
  <div class="books-grid">
    {% for progress in reading_progress_list %}
    <div class="book-progress-card">
      <div class="book-cover-section">
        {% if progress.book.cover_img %}
          <img src="{{ progress.book.cover_img.url }}" alt="{{ progress.book.name }}" loading="lazy">
        {% else %}
          <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 24px; font-weight: bold;">
            {{ progress.book.name|slice:":2" }}
          </div>
        {% endif %}

        <div class="book-status-badge status-{{ progress.status }}">
          {% if progress.status == 'reading' %}ì½ëŠ” ì¤‘
          {% elif progress.status == 'completed' %}ì™„ë…
          {% elif progress.status == 'paused' %}ì¼ì‹œì¤‘ì§€
          {% endif %}
        </div>
      </div>

      <div class="book-info-section">
        <h3 class="book-title">{{ progress.book.name }}</h3>
        <div class="book-meta">
          {% for genre in progress.book.genres.all|slice:":2" %}
            {{ genre.name }}{% if not forloop.last %}, {% endif %}
          {% endfor %}
        </div>

        <div class="progress-section">
          <div class="progress-info">
            <span>{{ progress.last_read_content_number }}í™” / {{ progress.book.contents.count }}í™”</span>
            <span class="progress-percentage">{{ progress.get_progress_percentage }}%</span>
          </div>
          <div class="progress-bar-container">
            <div class="progress-bar" style="width: {{ progress.get_progress_percentage }}%"></div>
          </div>
        </div>

        <div class="book-actions">
<a href="{% url 'book:content_detail' progress.current_content.id %}" 
   class="btn-action btn-continue">    
        {% if progress.status == 'completed' %}ë‹¤ì‹œ ì½ê¸°{% else %}ì´ì–´ ì½ê¸°{% endif %}
          </a>
          <a href="{% url 'book:book_detail' progress.book.id %}" class="btn-action btn-secondary">ìƒì„¸ ì •ë³´</a>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="empty-state">
    <div class="empty-state-icon">ğŸ“š</div>
    <h3 class="empty-state-title">ì•„ì§ ì½ì€ ì±…ì´ ì—†ìŠµë‹ˆë‹¤</h3>
    <p class="empty-state-text">ìƒˆë¡œìš´ ì´ì•¼ê¸°ë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”!</p>
    <a href="{% url 'main:main' %}" class="btn-browse">ì±… ë‘˜ëŸ¬ë³´ê¸°</a>
  </div>
  {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
// ì¶”í›„ AJAXë¡œ ì§„í–‰ ìƒí™© ì—…ë°ì´íŠ¸ ê¸°ëŠ¥ ì¶”ê°€ ê°€ëŠ¥
</script>
{% endblock %}
