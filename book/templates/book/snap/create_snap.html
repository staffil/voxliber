{% extends "base.html" %}
{% load static %}

{% block title %}ë¶ ìŠ¤ëƒ… ë§Œë“¤ê¸° - VOXLIBER{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/book/snap/create_snap.css' %}">
{% endblock %}


{% block content %}

<!-- <script>
// í˜ì´ì§€ ì ‘ê·¼ ì œí•œ - ë©”ì¸ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
(function() {
    window.location.href = '/';
})();
</script> -->

<div class="snap-container">

    <!-- LEFT: Preview -->
    <div class="snap-preview-wrapper">
        <div class="snap-preview" id="snap-preview">
            9:16 ë¯¸ë¦¬ë³´ê¸°
        </div>
    </div>

    <!-- RIGHT: Form -->
    <form method="POST" enctype="multipart/form-data" class="snap-form">
        {% csrf_token %}

        <h2 class="section-title">ğŸ“± ì‡¼ì¸  ìŠ¤ëƒ… ë§Œë“¤ê¸°</h2>

        {% if error %}
            <div class="message error">{{ error }}</div>
        {% endif %}
        {% if success %}
            <div class="message success">{{ success }}</div>
        {% endif %}

        <div class="input-group">
            <label class="input-label">ì´ë¯¸ì§€ ì—…ë¡œë“œ</label>
            <input type="file" name="image" accept="image/*" id="image-input" class="input-field">
        </div>

        <div class="input-group">
            <label class="input-label">ë¹„ë””ì˜¤ ì—…ë¡œë“œ (ì„ íƒ)</label>
            <input type="file" name="video" accept="video/*" id="video-input" class="input-field">
        </div>



        <!-- ğŸ”¥ ë§í¬ ì…ë ¥ ì¶”ê°€ -->

        <div class="input-group">

            <label class="input-label">ì—°ê²°í•  ì±… ë§í¬</label>
            <select name="book_link" id="book_link" class="input-field">
                <option value="">ì„ íƒ ì•ˆ í•¨</option>
                {% for url, name in select_link %}
                    <option value="{{ url }}">{{ name }}</option>
                {% endfor %}
            </select>
        </div>
        
        <div class="input-group">
            <label class="input-label">íƒ€ ë§í¬ ì„ íƒ (ì—°ê²°í•  ì±…ì„ ìš°ì„¤ ë§í¬ë¡œ í•©ë‹ˆë‹¤)</label>
            <input type="url" name="link" placeholder="https://example.com" class="input-field">
        </div>

        <div class="input-group">
            <label class="input-label">ì œëª©</label>
            <input type="text" name="title" class="input-field" placeholder="ìŠ¤ëƒ… ì œëª© ì…ë ¥">
        </div>

        <div class="input-group">
            <label class="input-label">ì„¤ëª…</label>
            <textarea name="description" class="input-field" placeholder="ì„¤ëª… ì…ë ¥"></textarea>
        </div>

        <button class="submit-btn" type="submit">ìŠ¤ëƒ… ìƒì„±í•˜ê¸°</button>

    </form>
</div>

{% endblock %}

{% block extra_js %}
<script>
const previewBox = document.getElementById("snap-preview");

/* ì´ë¯¸ì§€ í”„ë¦¬ë·° */
document.getElementById("image-input").addEventListener("change", function(e) {
    const file = e.target.files[0];
    if (!file) return previewBox.innerHTML = "9:16 ë¯¸ë¦¬ë³´ê¸°";

    const reader = new FileReader();
    reader.onload = e => {
        previewBox.innerHTML = `<img src="${e.target.result}" />`;
    };
    reader.readAsDataURL(file);
});

/* ë¹„ë””ì˜¤ í”„ë¦¬ë·° */
document.getElementById("video-input").addEventListener("change", function(e) {
    const file = e.target.files[0];
    if (!file) return;

    const url = URL.createObjectURL(file);
    previewBox.innerHTML = `<video src="${url}" controls></video>`;
});
</script>
{% endblock %}
