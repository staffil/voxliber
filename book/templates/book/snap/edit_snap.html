{% extends "base.html" %}
{% load static %}

{% block title %}ë¶ ìŠ¤ëƒ… ìˆ˜ì • - VOXLIBER{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/book/snap/create_snap.css' %}">
{% endblock %}


{% block content %}

<!-- <script>
// í˜ì´ì§€ ì ‘ê·¼ ì œí•œ - ë©”ì¸ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
(function() {
    window.location.href = '/';
})();
</script> -->

<div class="snap-container">

    <!-- LEFT: Preview -->
    <div class="snap-preview-wrapper">
        <div class="snap-preview" id="snap-preview">
            {% if snap.snap_video %}
                <video src="{{ snap.snap_video.url }}" controls></video>
            {% elif snap.thumbnail %}
                <img src="{{ snap.thumbnail.url }}" alt="ìŠ¤ëƒ… ì¸ë„¤ì¼">
            {% else %}
                9:16 ë¯¸ë¦¬ë³´ê¸°
            {% endif %}
        </div>
    </div>

    <!-- RIGHT: Form -->
    <form method="POST" enctype="multipart/form-data" class="snap-form">
        {% csrf_token %}

        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 class="section-title">ğŸ“ ìŠ¤ëƒ… ìˆ˜ì •í•˜ê¸°</h2>
            <a href="{% url 'book:my_book_snap_list' %}" class="back-btn" style="padding: 8px 16px; background: rgba(255,255,255,0.1); border-radius: 8px; text-decoration: none; color: var(--text); font-size: 14px;">â† ë’¤ë¡œê°€ê¸°</a>
        </div>

        {% if error %}
            <div class="message error">{{ error }}</div>
        {% endif %}

        <div class="input-group">
            <label class="input-label">ì´ë¯¸ì§€ ì—…ë¡œë“œ</label>
            <input type="file" name="image" accept="image/*" id="image-input" class="input-field" data-login-required>
            {% if snap.thumbnail %}
                <div style="font-size: 12px; color: #888; margin-top: 5px;">
                    í˜„ì¬ ì´ë¯¸ì§€: {{ snap.thumbnail.name|slice:":30" }}...
                </div>
            {% endif %}
        </div>

        <div class="input-group">
            <label class="input-label">ë¹„ë””ì˜¤ ì—…ë¡œë“œ (ì„ íƒ)</label>
            <input type="file" name="video" accept="video/*" id="video-input" class="input-field" data-login-required>
            {% if snap.snap_video %}
                <div style="font-size: 12px; color: #888; margin-top: 5px;">
                    í˜„ì¬ ë¹„ë””ì˜¤: {{ snap.snap_video.name|slice:":30" }}...
                </div>
            {% endif %}
        </div>

        <!-- ë§í¬ ì…ë ¥ -->
 
        <div class="input-group">

            <label class="input-label">ì—°ê²°í•  ì˜¤ë””ì˜¤ë¶ ë§í¬</label>
            <select name="selected_book_url" id="selected_book_url" class="input-field"  data-login-required>
                <option value="">ì„ íƒ ì•ˆ í•¨</option>
                    {% for url, name in my_book_options %}
                            <option value="{{ url }}">{{ name }}</option>
                        {% endfor %}
                                </select>
        </div>

                <div class="input-group">

            <label class="input-label">ì—°ê²°í•  AI ì†Œì„¤ ë§í¬</label>
            <select name="selected_story_url" id="selected_story_url" class="input-field"  data-login-required>
                <option value="">ì„ íƒ ì•ˆ í•¨</option>
                {% for url, name in my_story_options %}
                        <option value="{{ url }}">{{ name }}</option>
                    {% endfor %}
                            </select>
        </div>
        


        <div class="input-group">
            <label class="input-label">íƒ€ ë§í¬ ì„ íƒ (ì—°ê²°í•  ì±…ì„ ìš°ì„  ë§í¬ë¡œ í•©ë‹ˆë‹¤)</label>
            <input type="url" name="link" placeholder="https://example.com" class="input-field" value="{{ snap.book_link }}" data-login-required>
        </div>

        <div class="input-group">
            <label class="input-label">ì œëª©</label>
            <input type="text" name="title" class="input-field" placeholder="ìŠ¤ëƒ… ì œëª© ì…ë ¥" value="{{ snap.snap_title }}" data-login-required>
        </div>

        <div class="input-group">
            <label class="input-label">ì„¤ëª…</label>
            <textarea name="description" class="input-field" placeholder="ì„¤ëª… ì…ë ¥" data-login-required>{{ snap.book_comment }}</textarea>
        </div>

        <div style="display: flex; gap: 10px;">
            <button class="submit-btn" type="submit" style="flex: 1;" data-login-required>ìˆ˜ì • ì™„ë£Œ</button>
            <a href="/snap/{{ snap.public_uuid }}/delete/"
               onclick="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')"
               class="submit-btn"
               style="flex: 1; background: #dc2626; text-align: center; display: inline-block; line-height: 50px; text-decoration: none;" data-login-required>
                ì‚­ì œí•˜ê¸°
            </a>
        </div>

    </form>
</div>

{% endblock %}

{% block extra_js %}
<script>
const previewBox = document.getElementById("snap-preview");

/* ì´ë¯¸ì§€ í”„ë¦¬ë·° */
document.getElementById("image-input").addEventListener("change", function(e) {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = e => {
        previewBox.innerHTML = `<img src="${e.target.result}" />`;
    };
    reader.readAsDataURL(file);
});

/* ë¹„ë””ì˜¤ í”„ë¦¬ë·° */
document.getElementById("video-input").addEventListener("change", function(e) {
    const file = e.target.files[0];
    if (!file) return;

    const url = URL.createObjectURL(file);
    previewBox.innerHTML = `<video src="${url}" controls></video>`;
});
</script>
{% endblock %}
