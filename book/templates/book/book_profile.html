{% extends "base.html" %}
{% load static %}

{% block title %}VOXLIBER - ì†Œì„¤ ì œëª©{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/book/book_profile.css' %}">
{% endblock %}

{% block content %}
<div class="novel-title-wrapper" style="margin-top: 100px;">
    <div class="novel-title-container">
        {% if error %}
        <div class="error-msg">{{ error }}</div>
        {% endif %}

        <form action="" method="post" enctype="multipart/form-data" id="book_profile_form">
            {% csrf_token %}

            <!-- ì†Œì„¤ ì œëª© -->
            <div class="title-header">
                <input type="text" name="novel_title" class="section-title" placeholder="ğŸ“š ì†Œì„¤ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
                    value="{{ book.name|default:'' }}" required>
            </div>

            <div class="title-content">
                <!-- ì™¼ìª½: í‘œì§€ -->
                <div class="novel-cover-section">
                    <div class="cover-wrapper">
                        <div class="cover-image" id="cover-preview">
                            {% if book and book.cover_img %}
                                <img src="{{ book.cover_img.url }}" id="preview-cover" alt="ì†Œì„¤ í‘œì§€" loading="lazy">
                            {% else %}
                                <img src="{% static 'images/default-novel-cover.jpg' %}" id="preview-cover" alt="ì†Œì„¤ í‘œì§€" loading="lazy">
                            {% endif %}
                            <div class="cover-overlay">
                                <span>í‘œì§€ ì„ íƒ</span>
                            </div>
                        </div>
                        <input type="file" name="cover-image" id="book-cover-image" accept="image/*" style="display: none;">
                    </div>
                </div>

                <!-- ì˜¤ë¥¸ìª½: ì •ë³´ -->
                <div class="novel-info-section">
                    <div class="info-card">
                        <label class="info-label">ğŸ“– ì†Œì„¤ ì¤„ê±°ë¦¬</label>
                        <textarea name="novel_description" placeholder="ì†Œì„¤ ì¤„ê±°ë¦¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."
                            rows="5">{{ book.description }}</textarea>
                    </div>

                    <div class="info-card">
                        <label class="info-label">ğŸ­ ì¥ë¥´ ì„ íƒ (ì—¬ëŸ¬ ê°œ ì„ íƒ ê°€ëŠ¥)</label>
                        <div class="genre-grid">
                            {% for genre in genres_list %}
                            <label class="genre-option">
                                <input type="checkbox" name="genres" value="{{ genre.id }}"
                                    {% if book and genre in book.genres.all %}checked{% endif %}>
                                <span class="genre-box" style="background-color: {{ genre.genres_color|default:'#FFF' }}">
                                    {{ genre.name }}
                                </span>
                            </label>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- íƒœê·¸ ê²€ìƒ‰/ì¶”ê°€ -->
                    <div class="info-card">
                        <label class="info-label">ğŸ·ï¸ íƒœê·¸ ì„ íƒ</label>
                        <div class="tag-input-wrapper">
                            <input type="text" id="tag-search" placeholder="íƒœê·¸ ê²€ìƒ‰ ë˜ëŠ” ì¶”ê°€...">
                            <button type="button" id="add-tag-btn">ì¶”ê°€</button>
                        </div>

                        <div class="selected-tags" id="selected-tags">
                            {% for tag in book.tags.all %}
                            <input type="hidden" name="tags" value="{{ tag.id }}">
                            <span class="selected-tag">{{ tag.name }}</span>
                            {% endfor %}
                        </div>

                        <div class="tag-list-wrapper">
                            <div class="tag-grid" id="tag-grid">
                                {% for tag in tag_list %}
                                <label class="tag-option">
                                    <input type="checkbox" class="tag-checkbox" value="{{ tag.id }}"
                                        {% if book and tag in book.tags.all %}checked{% endif %}>
                                    <span>{{ tag.name }}</span>
                                </label>
                                {% endfor %}
                            </div>
                        </div>
                    </div>

                    <!-- ì—°ì¬ ì£¼ê¸° ì„ íƒ -->
                    <div class="info-card">
                        <label class="info-label">ğŸ“… ì—°ì¬ ì£¼ê¸°</label>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <select name="episode_interval_weeks" style="
                                padding: 12px 16px;
                                background: var(--input-bg);
                                border: 1px solid var(--border-color);
                                border-radius: 8px;
                                color: var(--text-primary);
                                font-size: 14px;
                                cursor: pointer;
                                transition: all var(--transition-base);
                            " onmouseover="this.style.borderColor='var(--border-hover)'" onmouseout="this.style.borderColor='var(--border-color)'">
                                <option value="1" {% if book.episode_interval_weeks == 1 %}selected{% endif %}>ë§¤ì£¼ (1ì£¼ë§ˆë‹¤)</option>
                                <option value="2" {% if book.episode_interval_weeks == 2 %}selected{% endif %}>ê²©ì£¼ (2ì£¼ë§ˆë‹¤)</option>
                                <option value="3" {% if book.episode_interval_weeks == 3 %}selected{% endif %}>3ì£¼ë§ˆë‹¤</option>
                                <option value="4" {% if book.episode_interval_weeks == 4 %}selected{% endif %}>ë§¤ì›” (4ì£¼ë§ˆë‹¤)</option>
                            </select>
                            <div style="font-size: 12px; color: var(--text-tertiary); padding: 0 4px;">
                                ğŸ’¡ ì—í”¼ì†Œë“œë¥¼ ì–¼ë§ˆë‚˜ ìì£¼ ë“±ë¡í•  ê³„íšì¸ì§€ ì„ íƒí•˜ì„¸ìš”
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <button type="submit">ì €ì¥</button>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/book/book_profile.js' %}"></script>
<script src="{% static 'js/register/login.js' %}"></script>
{% endblock %}
