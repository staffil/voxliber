{% extends "base.html" %}
{% load static %}

{% block title %}{{ book.name }} - VOXLIBER{% endblock %}

{% block extra_head %}
<!-- Open Graph ë©”íƒ€ íƒœê·¸ (ì†Œì…œ ë¯¸ë””ì–´ ê³µìœ ìš©) -->
<meta property="og:title" content="{{ book.name }}">
<meta property="og:description" content="{{ book.description|default:'VoxLiberì—ì„œ ì˜¤ë””ì˜¤ë¶ì„ ì¦ê²¨ë³´ì„¸ìš”'|truncatewords:30 }}">
{% if book.cover_img %}
<meta property="og:image" content="{{ request.scheme }}://{{ request.get_host }}{{ book.cover_img.url }}">
{% else %}
<meta property="og:image" content="{{ request.scheme }}://{{ request.get_host }}{% static 'img/logo3.png' %}">
{% endif %}
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:url" content="{{ request.scheme }}://{{ request.get_host }}{% url 'book:book_detail' book.id %}">
<meta property="og:type" content="book">
<meta property="og:site_name" content="VoxLiber">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ book.name }}">
<meta name="twitter:description" content="{{ book.description|default:'VoxLiberì—ì„œ ì˜¤ë””ì˜¤ë¶ì„ ì¦ê²¨ë³´ì„¸ìš”'|truncatewords:30 }}">
{% if book.cover_img %}
<meta name="twitter:image" content="{{ request.scheme }}://{{ request.get_host }}{{ book.cover_img.url }}">
{% else %}
<meta name="twitter:image" content="{{ request.scheme }}://{{ request.get_host }}{% static 'img/logo3.png' %}">
{% endif %}
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/book/book_detail.css' %}">
<style>
.share-btn {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 10px 16px;
    background: rgba(99, 102, 241, 0.1);
    border: 1px solid rgba(99, 102, 241, 0.3);
    border-radius: 12px;
    color: #818cf8;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    transition: all 0.3s;
    white-space: nowrap;
}

.share-btn:hover {
    background: rgba(99, 102, 241, 0.2);
    transform: translateY(-2px);
}

.share-btn svg {
    flex-shrink: 0;
}
</style>

{% endblock %}

{% block content %}
<div class="book-detail-wrapper">
    <div class="book-header">
        <!-- 3D ì±… ì»¤ë²„ -->
        <div class="book-cover-wrapper">
            {% if book.cover_img %}
                <img src="{{ book.cover_img.url }}" alt="{{ book.name }}" loading="lazy">
            {% else %}
                <div class="book-cover-placeholder">{{ book.name|slice:":2" }}</div>
            {% endif %}
        </div>

        <div class="book-info-section">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px;">
                <h1 class="book-title" style="margin: 0;">{{ book.name }}</h1>
                <button onclick="shareBook()" class="share-btn" title="ê³µìœ í•˜ê¸°">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="18" cy="5" r="3"/>
                        <circle cx="6" cy="12" r="3"/>
                        <circle cx="18" cy="19" r="3"/>
                        <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
                        <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
                    </svg>
                    <span>ê³µìœ </span>
                </button>
            </div>

            <div class="book-author">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 6px;">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                    <circle cx="12" cy="7" r="4"/>
                </svg>
                <span>{{ book.user.nickname }}</span>
            </div>

            <div class="book-genres">
                {% for genre in book.genres.all %}
                <span class="genre-tag" style="background-color: {{ genre.genres_color }}30; border-color: {{ genre.genres_color }}; color: {{ genre.genres_color }};">
                    {{ genre.name }}
                </span>
                {% endfor %}


            </div>

            <div>
                {% for tag in book.tags.all %}
                <span class="book-tag">{{ tag.name }}</span>
                {% endfor %}
            </div>

            <div class="book-stats-row">
                <div class="rating-display">
                    <span class="rating-number">{{ avg_rating }}</span>
                    <div>
                        <div class="rating-stars">
                            {% for i in "12345" %}
                                <span class="star {% if forloop.counter <= avg_rating %}active{% endif %}">â­</span>
                            {% endfor %}
                        </div>
                        <div style="font-size: 13px; color: rgba(255,255,255,0.5); margin-top: 4px;">{{ review_count }}ê°œ ë¦¬ë·°</div>
                    </div>
                </div>

                <div class="stat-item">
                    <span class="stat-label">ì—í”¼ì†Œë“œ</span>
                    <span class="stat-value">{{ contents|length }}ê°œ</span>
                </div>

                <div class="stat-item">
                    <span class="stat-label">ì¶œê°„ì¼</span>
                    <span class="stat-value" style="font-size: 18px;">{{ book.created_at|date:"Y.m.d" }}</span>
                </div>
            </div>
<div class="book-status">
    {% if book.status == "ongoing" %}
        <span class="status-badge ongoing">ì—°ì¬ ì¤‘</span>
    {% elif book.status == "paused" %}
        <span class="status-badge paused">íœ´ì¬</span>
    {% else %}
        <span class="status-badge ended">ì—°ì¬ ì¢…ë£Œ</span>
    {% endif %}
</div>

        </div>
    </div>

        <!-- ì†Œê°œ ì˜¤ë””ì˜¤ ì—…ë¡œë“œ -->
        {% with first_episode=book.contents.first %}
        {% if first_episode %}
            <div class="intro-audio-wrapper">
                <div class="intro-audio-title">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                        <path d="M15.54 8.46a5 5 0 0 1 0 7.07"/>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14"/>
                    </svg>
                    <span>ë¯¸ë¦¬ë“£ê¸° (1í™”)</span>
                </div>

                {% if first_episode.audio_file %}
                    <!-- 1í™” ì˜¤ë””ì˜¤ í”Œë ˆì´ì–´ -->
                    <div class="intro-audio-player-box">
                        <div class="custom-audio-player">
                            <audio id="introAudio" style="display: none;" loading="lazy">
                                <source src="{{ first_episode.audio_file.url }}" type="audio/mpeg">
                            </audio>

                            <div class="audio-controls-row">
                                <button class="audio-play-btn" id="introPlayBtn" onclick="toggleIntroAudio()">
                                    â–¶
                                </button>

                                <div class="audio-progress-wrapper">
                                    <div class="audio-progress-container" id="introProgressContainer">
                                        <div class="audio-progress-bar" id="introProgressBar" style="width: 0%"></div>
                                    </div>
                                </div>

                                <div class="audio-time-info">
                                    <span id="introCurrentTime">0:00</span>
                                    <span>/</span>
                                    <span id="introDuration">0:00</span>
                                </div>

                                <div class="audio-volume-control">
                                    <button class="audio-volume-btn" id="introVolumeBtn" onclick="toggleIntroMute()">
                                        ğŸ”Š
                                    </button>
                                    <input type="range" class="audio-volume-slider" id="introVolumeSlider" min="0" max="100" value="100">
                                </div>
                            </div>
                        </div>
                        <!-- <a href="{% url 'book:content_detail' first_episode.id %}" class="listen-full-btn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M8 5v14l11-7z"/>
                            </svg>
                            ì „ì²´ ë“£ê¸°
                        </a> -->
                    </div>

                {% else %}
                    <!-- 1í™” ì˜¤ë””ì˜¤ ì—†ëŠ” ê²½ìš° -->
                    <p class="no-audio-message">1í™” ì˜¤ë””ì˜¤ê°€ ì•„ì§ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
                {% endif %}

            </div>
        {% endif %}
        {% endwith %}
<br>

    <div class="content-section book-description">
        <h2 class="section-title">ì‘í’ˆ ì†Œê°œ</h2>
        <div style="font-size: 16px; line-height: 1.8; color: rgba(255,255,255,0.85);">
            {{ book.description|linebreaks|default:"ì‘í’ˆ ì†Œê°œê°€ ì•„ì§ ì‘ì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤." }}
        </div>
    </div>

    <!-- ì‘ê°€ ê³µì§€ì‚¬í•­ -->
    {% if announcements or request.user == book.user %}
    <div class="announcements-section" style="margin: 40px 0; padding: 24px; background: var(--bg-secondary); border-radius: 16px; border: 1px solid var(--border-color);">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 class="section-title">ğŸ“¢ ì‘ê°€ì˜ ë§</h2>
            {% if request.user == book.user %}
            <button onclick="toggleAnnouncementForm()" style="padding: 8px 16px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px;">
                â• ê³µì§€ ì‘ì„±
            </button>
            {% endif %}
        </div>

        <!-- ê³µì§€ì‚¬í•­ ì‘ì„± í¼ (ì‘ê°€ë§Œ) -->
        {% if request.user == book.user %}
        <div id="announcementForm" style="display: none; margin-bottom: 24px; padding: 20px; background: var(--bg-primary); border-radius: 12px; border: 1px solid var(--border-color);">
            <form method="post" action="{% url 'book:create_announcement' book.id %}">
                {% csrf_token %}
                <div style="margin-bottom: 16px;">
                    <label style="display: block; margin-bottom: 8px; color: var(--text-primary); font-weight: 600;">ì œëª©</label>
                    <input type="text" name="title" placeholder="ê³µì§€ì‚¬í•­ ì œëª©" required style="width: 100%; padding: 12px; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 14px;">
                </div>
                <div style="margin-bottom: 16px;">
                    <label style="display: block; margin-bottom: 8px; color: var(--text-primary); font-weight: 600;">ë‚´ìš©</label>
                    <textarea name="content" placeholder="ê³µì§€ì‚¬í•­ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..." required style="width: 100%; min-height: 120px; padding: 12px; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 14px; resize: vertical;"></textarea>
                </div>
                <div style="margin-bottom: 16px;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="checkbox" name="is_pinned" style="width: 18px; height: 18px;">
                        <span style="color: var(--text-primary); font-size: 14px;">ğŸ“Œ ìƒë‹¨ì— ê³ ì •</span>
                    </label>
                </div>
                <div style="display: flex; gap: 8px;">
                    <button type="submit" style="flex: 1; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">ì‘ì„± ì™„ë£Œ</button>
                    <button type="button" onclick="toggleAnnouncementForm()" style="padding: 12px 24px; background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border-color); border-radius: 8px; cursor: pointer;">ì·¨ì†Œ</button>
                </div>
            </form>
        </div>
        {% endif %}

        <!-- ê³µì§€ì‚¬í•­ ëª©ë¡ -->
        {% if announcements %}
            {% for announcement in announcements %}
            <div class="announcement-card" style="background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; margin-bottom: 16px; {% if announcement.is_pinned %}border-color: var(--primary); background: linear-gradient(135deg, rgba(99, 102, 241, 0.05) 0%, rgba(139, 92, 246, 0.05) 100%);{% endif %}">
                {% if announcement.is_pinned %}
                <div style="display: inline-block; background: var(--primary); color: white; padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 600; margin-bottom: 8px;">ğŸ“Œ ê³ ì •</div>
                {% endif %}
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                    <h4 style="font-size: 16px; font-weight: 600; color: var(--text-primary); margin: 0;">{{ announcement.title }}</h4>
                    <span style="font-size: 12px; color: var(--text-secondary);">{{ announcement.created_at|date:"Yë…„ mì›” dì¼" }}</span>
                </div>
                <div style="color: var(--text-primary); line-height: 1.6; margin-bottom: 12px;">
                    {{ announcement.content|linebreaks }}
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; padding-top: 8px; border-top: 1px solid var(--border-color);">
                    <span style="font-size: 13px; color: var(--text-secondary); font-style: italic;">- {{ announcement.author.nickname }}</span>
                    {% if request.user == announcement.author %}
                    <form method="post" action="{% url 'book:delete_announcement' announcement.id %}" style="margin: 0;" onsubmit="return confirm('ì •ë§ ì´ ê³µì§€ì‚¬í•­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                        {% csrf_token %}
                        <button type="submit" style="padding: 6px 12px; background: #dc2626; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px;">ì‚­ì œ</button>
                    </form>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        {% else %}
            {% if request.user != book.user %}
            <p style="text-align: center; color: var(--text-secondary); padding: 20px 0;">ì•„ì§ ì‘ì„±ëœ ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            {% endif %}
        {% endif %}
    </div>
    {% endif %}

    <div class="content-section episodes-section">
        <h2 class="section-title">ì—í”¼ì†Œë“œ ëª©ë¡{% if request.user == book.user %} <span style="font-size: 14px; color: rgba(255,255,255,0.5); font-weight: normal;">(ë“œë˜ê·¸í•˜ì—¬ ìˆœì„œ ë³€ê²½ ê°€ëŠ¥)</span>{% endif %}</h2>
        {% if contents %}
            <div class="episodes-grid" id="episodesGrid">
            {% for content in contents %}
                <div class="episode-wrapper" data-content-id="{{ content.id }}" {% if request.user == book.user %}draggable="true"{% endif %} style="display: flex; align-items: stretch; gap: 12px;">
                    {% if request.user == book.user %}
                    <div class="drag-handle" style="display: flex; align-items: center; cursor: grab; padding: 0 8px; color: rgba(255,255,255,0.3);">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="8" y1="6" x2="16" y2="6"/>
                            <line x1="8" y1="12" x2="16" y2="12"/>
                            <line x1="8" y1="18" x2="16" y2="18"/>
                        </svg>
                    </div>
                    {% endif %}
                    <a href="{% url 'book:content_detail' content.id %}" class="episode-card" style="flex: 1; text-decoration: none;">
                        <div class="episode-number">
                            {% if content.episode_image %}
                            <img src="{{ content.episode_image.url }}" alt="Episode {{ content.number }}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 12px;" loading="lazy">
                            {% else %}
                            {{ content.number }}
                            {% endif %}
                        </div>
                        <div class="episode-info">
                            <div class="episode-title">{{ content.number }}, {{ content.title }}</div>
                            <div class="episode-meta">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 4px;">
                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                    <line x1="16" y1="2" x2="16" y2="6"/>
                                    <line x1="8" y1="2" x2="8" y2="6"/>
                                    <line x1="3" y1="10" x2="21" y2="10"/>
                                </svg>
                                {{ content.created_at|date:"Yë…„ mì›” dì¼" }}
                            </div>
                        </div>
                        <div class="episode-play-icon">â–¶</div>
                    </a>

                    {% if request.user == book.user %}
                    <form method="post" action="{% url 'book:delete_content' content.id %}" style="margin: 0; display: flex; align-items: center;" onsubmit="return confirm('ì •ë§ ì´ ì—í”¼ì†Œë“œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                        {% csrf_token %}
                        <button type="submit" style="padding: 10px 16px; background: rgba(220, 38, 38, 0.1); border: 1px solid rgba(220, 38, 38, 0.3); color: #ef4444; border-radius: 12px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s; display: flex; align-items: center; gap: 6px; height: fit-content;" onmouseover="this.style.background='rgba(220, 38, 38, 0.2)'" onmouseout="this.style.background='rgba(220, 38, 38, 0.1)'">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="3 6 5 6 21 6"/>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                <line x1="10" y1="11" x2="10" y2="17"/>
                                <line x1="14" y1="11" x2="14" y2="17"/>
                            </svg>
                            ì‚­ì œ
                        </button>
                    </form>
                    {% endif %}
                </div>
            {% endfor %}
            </div>
            
        {% else %}
        <p style="text-align: center; color: rgba(255,255,255,0.5); padding: 60px 0; font-size: 16px;">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="opacity: 0.3; margin-bottom: 16px; display: block; margin-left: auto; margin-right: auto;">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                <polyline points="14 2 14 8 20 8"/>
            </svg>
            ì•„ì§ ì‘ì„±ëœ ì—í”¼ì†Œë“œê°€ ì—†ìŠµë‹ˆë‹¤.
        </p>
        {% endif %}
        {% if contents.has_other_pages %}
<div class="pagination" style="display: flex; justify-content: center; gap: 6px; margin-top: 32px;">

    {# Previous #}
    {% if contents.has_previous %}
        <a href="?page={{ contents.previous_page_number }}" class="page-btn">ì´ì „</a>
    {% else %}
        <span class="page-btn disabled">ì´ì „</span>
    {% endif %}

    {# Page numbers #}
    {% for i in contents.paginator.page_range %}
        {% if i == contents.number %}
            <span class="page-btn active">{{ i }}</span>
        {% else %}
            <a href="?page={{ i }}" class="page-btn">{{ i }}</a>
        {% endif %}
    {% endfor %}

    {# Next #}
    {% if contents.has_next %}
        <a href="?page={{ contents.next_page_number }}" class="page-btn">ë‹¤ìŒ</a>
    {% else %}
        <span class="page-btn disabled">ë‹¤ìŒ</span>
    {% endif %}
</div>
{% endif %}
    </div>
    {% if request.user.is_authenticated and request.user != book.user %}
    <div class="review-write-section">
        <h3 style="margin-bottom: 16px; color: #fff;">â­ ì´ ì‘í’ˆì„ í‰ê°€í•´ì£¼ì„¸ìš”</h3>
        <div class="star-rating-input" id="starRating" data-user-rating="{% if user_review %}{{ user_review.rating }}{% else %}5{% endif %}">
            <span class="star" data-rating="1">â˜†</span>
            <span class="star" data-rating="2">â˜†</span>
            <span class="star" data-rating="3">â˜†</span>
            <span class="star" data-rating="4">â˜†</span>
            <span class="star" data-rating="5">â˜†</span>
        </div>
        <textarea id="reviewText" class="review-textarea" placeholder="ì´ ì‘í’ˆì— ëŒ€í•œ ë¦¬ë·°ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”..." data-submit-url="{% url 'book:submit_review' book.id %}">{% if user_review %}{{ user_review.review_text }}{% endif %}</textarea>
        <button class="submit-review-btn" onclick="submitReview()">{% if user_review %}ë¦¬ë·° ìˆ˜ì •í•˜ê¸°{% else %}ë¦¬ë·° ë“±ë¡í•˜ê¸°{% endif %}</button>
    </div>
    {% endif %}

    {% if recent_reviews %}
    <div class="content-section reviews-list">
        <h2 class="section-title">ìµœê·¼ ë¦¬ë·°</h2>
        {% for review in recent_reviews %}
        <div class="review-item">
            <div class="review-header">
                <div class="reviewer-info">
                    <span class="reviewer-name">{{ review.user.nickname }}</span>
                    <span class="review-stars">{% for i in "12345" %}{% if forloop.counter <= review.rating %}â­{% else %}â˜†{% endif %}{% endfor %}</span>
                </div>
                <span class="review-date">{{ review.created_at|date:"Yë…„ mì›” dì¼" }}</span>
            </div>
            {% if review.review_text %}
                <div class="review-text">{{ review.review_text }}</div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="content-section comments-section">
        <h2 class="section-title">ëŒ“ê¸€ ({{ comments.count }})</h2>
        {% if request.user.is_authenticated %}
        <div style="margin-bottom: 32px;">
            <textarea id="commentInput" class="comment-input" placeholder="ëŒ“ê¸€ì„ ë‚¨ê²¨ì£¼ì„¸ìš”..." data-submit-url="{% url 'book:submit_book_comment' book.id %}"></textarea>
            <button class="submit-comment-btn" onclick="submitComment()">ëŒ“ê¸€ ì‘ì„±</button>
        </div>
        {% endif %}
        <div id="commentsList">
            {% for comment in comments %}
            <div class="comment-item">
                <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                    <span class="comment-author">{{ comment.user.nickname }}</span>
                    <span class="comment-date">{{ comment.created_at|date:"Y.m.d H:i" }}</span>
                </div>
                <div class="comment-text">{{ comment.comment }}</div>
                {% if request.user.is_authenticated %}
                    <button class="reply-btn" onclick="toggleReplyForm({{ comment.id }})">ë‹µê¸€</button>
                {% endif %}
                <div class="reply-form" id="replyForm{{ comment.id }}">
                    <textarea class="comment-input" id="replyInput{{ comment.id }}" placeholder="ë‹µê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..." style="min-height: 100px; margin-top: 12px;"></textarea>
                    <button class="submit-comment-btn" onclick="submitReply({{ comment.id }})" style="margin-top: 12px;">ë‹µê¸€ ì‘ì„±</button>
                </div>
                {% for reply in comment.replies.all %}
                <div class="comment-reply">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                        <span style="font-weight: 700; color: #667eea;">{{ reply.user.nickname }}</span>
                        <span class="comment-date">{{ reply.created_at|date:"Y.m.d H:i" }}</span>
                    </div>
                    <div class="comment-text">{{ reply.comment }}</div>
                </div>
                {% endfor %}
            </div>
            {% empty %}
            <p style="text-align: center; color: rgba(255,255,255,0.5); padding: 60px 0; font-size: 16px;">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="opacity: 0.3; margin-bottom: 12px; display: block; margin-left: auto; margin-right: auto;">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                </svg>
                ì•„ì§ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤. ì²« ëŒ“ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”!
            </p>
            {% endfor %}
        </div>
        
    </div>


</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/book/book_detail.js' %}"></script>
<script>
// CSRF í† í° ê°€ì ¸ì˜¤ê¸°
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

const csrftoken = getCookie('csrftoken');
</script>
{% endblock %}
