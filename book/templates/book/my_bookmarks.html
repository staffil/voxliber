{% extends "base.html" %}
{% load static %}

{% block title %}ë‚´ ë¶ë§ˆí¬ - VOXLIBER{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/book/my_books.css' %}">
<style>
/* Dark mode (default) */
.bookmark-item {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 16px;
    padding: 20px;
    margin-bottom: 16px;
    display: flex;
    gap: 20px;
    transition: all 0.3s;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.bookmark-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
    border-color: rgba(99, 102, 241, 0.3);
}

.bookmark-cover {
    width: 150px;
    height: 267px; /* 9:16 ë¹„ìœ¨ ìœ ì§€ (150 * 16/9 = 266.67) */
    border-radius: 12px;
    overflow: hidden;
    flex-shrink: 0;
}

.bookmark-cover img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.bookmark-info {
    flex: 1;
    max-width: 600px; /* ê³ ì • ë„ˆë¹„ë¡œ ì˜¤ë¥¸ìª½ ì—¬ë°± í™•ë³´ */
    min-width: 0; /* flex ì•„ì´í…œì˜ overflowë¥¼ ìœ„í•´ í•„ìš” */
}

.bookmark-title {
    font-size: 20px;
    font-weight: 700;
    color: #fff;
    margin-bottom: 8px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.bookmark-author {
    color: rgba(255, 255, 255, 0.7);
    margin-bottom: 12px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.bookmark-note {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    padding: 12px;
    margin-top: 12px;
    color: rgba(255, 255, 255, 0.8);
    font-size: 14px;
}

.bookmark-actions {
    display: flex;
    gap: 8px;
    margin-top: 12px;
}

.btn-primary {
    padding: 8px 16px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    border-radius: 8px;
    color: white;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}

.btn-secondary {
    padding: 8px 16px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    color: rgba(255, 255, 255, 0.8);
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
}

.btn-secondary:hover {
    background: rgba(255, 255, 255, 0.15);
}

.empty-state {
    text-align: center;
    padding: 80px 20px;
    color: rgba(255, 255, 255, 0.5);
}

.empty-state svg {
    margin-bottom: 24px;
    opacity: 0.3;
}

/* Light mode overrides */
body.light-mode .bookmark-item {
    background: rgba(0, 0, 0, 0.02);
    border: 1px solid rgba(0, 0, 0, 0.08);
}

body.light-mode .bookmark-item:hover {
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
    border-color: rgba(99, 102, 241, 0.3);
}

body.light-mode .bookmark-title {
    color: #1a1a1a;
}

body.light-mode .bookmark-author {
    color: rgba(0, 0, 0, 0.6);
}

body.light-mode .bookmark-note {
    background: rgba(0, 0, 0, 0.03);
    color: rgba(0, 0, 0, 0.7);
}

body.light-mode .btn-secondary {
    background: rgba(0, 0, 0, 0.05);
    border: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0, 0, 0, 0.7);
}

body.light-mode .btn-secondary:hover {
    background: rgba(0, 0, 0, 0.08);
}

body.light-mode .empty-state {
    color: rgba(0, 0, 0, 0.4);
}

body.light-mode .page-title {
    color: #1a1a1a !important;
}

body.light-mode .page-subtitle {
    color: rgba(0, 0, 0, 0.5) !important;
}

/* ===============================
   ë°˜ì‘í˜• (Responsive)
=============================== */

/* íƒœë¸”ë¦¿ (768px ì´í•˜) */
@media (max-width: 768px) {
    .bookmark-item {
        gap: 16px;
    }

    .bookmark-cover {
        width: 100px;
        height: 178px; /* 9:16 ë¹„ìœ¨ ìœ ì§€ */
    }

    .bookmark-title {
        font-size: 18px;
    }
}

/* ëª¨ë°”ì¼ (480px ì´í•˜) */
@media (max-width: 480px) {
    .bookmark-item {
        padding: 16px;
        gap: 12px;
    }

    .bookmark-cover {
        width: 130px;
        height: 220px; /* 9:16 ë¹„ìœ¨ ìœ ì§€ */
    }

    .bookmark-title {
        font-size: 16px;
    }

    .bookmark-author {
        font-size: 14px;
    }

    .bookmark-actions {
        flex-direction: column;
    }

    .btn-primary,
    .btn-secondary {
        width: 100%;
        text-align: center;
    }
}
</style>
{% endblock %}

{% block content %}
<div style="max-width: 1200px; margin: 120px auto 40px; padding: 0 20px;">
    <div style="margin-bottom: 32px;">
        <h1 class="page-title" style="font-size: 32px; font-weight: 700; margin-bottom: 8px; color: #fff;">ğŸ“š ë‚´ ë¶ë§ˆí¬</h1>
        <p class="page-subtitle" style="color: rgba(255, 255, 255, 0.6);">ë‚˜ì¤‘ì— ì½ê³  ì‹¶ì€ ì±…ì„ ëª¨ì•„ë³´ì„¸ìš”</p>
    </div>

    {% if bookmarks %}
        <div>
            {% for bookmark in bookmarks %}
            <div class="bookmark-item">
                <div class="bookmark-cover">
                    {% if bookmark.book.cover_img %}
                        <img src="{{ bookmark.book.cover_img.url }}" alt="{{ bookmark.book.name }}">
                    {% else %}
                        <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: 700; color: white;">
                            {{ bookmark.book.name|slice:":2" }}
                        </div>
                    {% endif %}
                </div>

                <div class="bookmark-info">
                    <h3 class="bookmark-title">{{ bookmark.book.name }}</h3>
                    <div class="bookmark-author">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 4px;">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                        {{ bookmark.book.user.nickname }}
                    </div>

                    <div style="display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 4px;">
                        {% for genre in bookmark.book.genres.all %}
                        <span style="padding: 3px 10px; background: rgba(99, 102, 241, 0.15); border-radius: 10px; font-size: 11px; color: #818cf8; font-weight: 500;">
                            {{ genre.name }}
                        </span>
                        {% endfor %}
                    </div>

                    {% if bookmark.note %}
                    <div class="bookmark-note">
                        <strong>ë©”ëª¨:</strong> {{ bookmark.note }}
                    </div>
                    {% endif %}

                    <div class="bookmark-actions">
                        <a href="{% url 'book:book_detail' bookmark.book.id %}" class="btn-primary">
                            ì±… ë³´ê¸°
                        </a>
                        <button onclick="removeBookmark({{ bookmark.book.id }})" class="btn-secondary">
                            ë¶ë§ˆí¬ ì œê±°
                        </button>
                    </div>

                    <div style="margin-top: 12px; font-size: 12px; color: rgba(255, 255, 255, 0.4);">
                        ì €ì¥ì¼: {{ bookmark.created_at|date:"Yë…„ mì›” dì¼" }}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
        {% if bookmarks.has_other_pages %}
        <div style="display: flex; justify-content: center; gap: 8px; margin-top: 32px;">
            {% if bookmarks.has_previous %}
                <a href="?page={{ bookmarks.previous_page_number }}" style="padding: 8px 16px; background: rgba(255, 255, 255, 0.1); border-radius: 8px; color: white; text-decoration: none;">ì´ì „</a>
            {% endif %}

            <span style="padding: 8px 16px; color: rgba(255, 255, 255, 0.6);">
                {{ bookmarks.number }} / {{ bookmarks.paginator.num_pages }}
            </span>

            {% if bookmarks.has_next %}
                <a href="?page={{ bookmarks.next_page_number }}" style="padding: 8px 16px; background: rgba(255, 255, 255, 0.1); border-radius: 8px; color: white; text-decoration: none;">ë‹¤ìŒ</a>
            {% endif %}
        </div>
        {% endif %}
    {% else %}
        <div class="empty-state">
            <svg width="120" height="120" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/>
            </svg>
            <h2 style="font-size: 24px; margin-bottom: 12px;">ë¶ë§ˆí¬í•œ ì±…ì´ ì—†ìŠµë‹ˆë‹¤</h2>
            <p style="margin-bottom: 24px;">ë‚˜ì¤‘ì— ì½ê³  ì‹¶ì€ ì±…ì„ ë¶ë§ˆí¬í•´ë³´ì„¸ìš”!</p>
            <a href="{% url 'main:main' %}" style="display: inline-block; padding: 12px 24px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; color: white; text-decoration: none; font-weight: 600;">
                ì±… ë‘˜ëŸ¬ë³´ê¸°
            </a>
        </div>
    {% endif %}
</div>

<script>
async function removeBookmark(bookId) {
    if (!confirm('ë¶ë§ˆí¬ë¥¼ ì œê±°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        return;
    }

    try {
        const response = await fetch(`/book/bookmark/${bookId}/toggle/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': getCookie('csrftoken')
            },
            credentials: 'same-origin'
        });

        if (response.ok) {
            alert('ë¶ë§ˆí¬ê°€ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤');
            location.reload();
        } else {
            throw new Error('ë¶ë§ˆí¬ ì œê±° ì‹¤íŒ¨');
        }
    } catch (error) {
        console.error('ë¶ë§ˆí¬ ì œê±° ì‹¤íŒ¨:', error);
        alert('ë¶ë§ˆí¬ ì œê±°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
    }
}

function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
</script>
{% endblock %}
