{% extends "base.html" %}
{% load static %}

{% block title %}ì‘ê°€ ì„¼í„° - VOXLIBER{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/book/author_dashboard.css' %}">
{% endblock %}

{% block content %}
<div class="dashboard-container">



    <!-- ===================== -->
    <!-- íƒ­ ë²„íŠ¼ -->
    <!-- ===================== -->
    <div class="dashboard-tabs">
        <button class="tab-btn active" data-tab="audiobook">
            ğŸ“š ì˜¤ë””ì˜¤ë¶ ì†Œì„¤
        </button>
        <button class="tab-btn" data-tab="ai">
            ğŸ¤– AI ì†Œì„¤
        </button>
    </div>

    <!-- ===================== -->
    <!-- ì˜¤ë””ì˜¤ë¶ ì†Œì„¤ íƒ­ -->
    <!-- ===================== -->
    <div class="tab-content active" id="tab-audiobook">

        {% if total_books > 0 %}
        <div class="stats-grid">

            <div class="stat-card">
                <div class="stat-card-header">
                    <div class="stat-icon primary">ğŸ“š</div>
                </div>
                <div class="stat-card-value">{{ total_books }}</div>
                <div class="stat-card-title">ì´ ì‘í’ˆ ìˆ˜</div>
                <div class="stat-card-subtitle">{{ total_contents }}ê°œ ì—í”¼ì†Œë“œ</div>
            </div>

            <div class="stat-card">
                <div class="stat-card-header">
                    <div class="stat-icon success">ğŸ‘¥</div>
                </div>
                <div class="stat-card-value">{{ total_readers }}</div>
                <div class="stat-card-title">ì´ ë…ì ìˆ˜</div>
                <div class="stat-card-subtitle">ìµœê·¼ 30ì¼: {{ recent_readers }}ëª…</div>
            </div>

            <div class="stat-card">
                <div class="stat-card-header">
                    <div class="stat-icon info">â¤ï¸</div>
                </div>
                <div class="stat-card-value">{{ total_followers }}</div>
                <div class="stat-card-title">íŒ”ë¡œì›Œ ìˆ˜</div>
                <div class="stat-card-subtitle">ë‚˜ë¥¼ íŒ”ë¡œìš°í•˜ëŠ” ë…ì</div>
            </div>

            <div class="stat-card">
                <div class="stat-card-header">
                    <div class="stat-icon warning">ğŸ§</div>
                </div>
                <div class="stat-card-value">{{ total_audio_duration }}</div>
                <div class="stat-card-title">ì´ ì˜¤ë””ì˜¤ ê¸¸ì´</div>
                <div class="stat-card-subtitle">ì „ì²´ ì‘í’ˆ í•©ê³„</div>
            </div>

        </div>

        <!-- ì‘í’ˆë³„ í†µê³„ -->
        <div class="book-stats-section">
            <h2 class="section-title">ì‘í’ˆë³„ í†µê³„</h2>

            <div class="book-stats-grid">
                {% for stat in book_stats %}
                <div class="book-stat-card">

                    <div class="book-stat-header">
                        <div class="book-cover-mini">
                            {% if stat.book.cover_img %}
                            <img src="{{ stat.book.cover_img.url }}" alt="{{ stat.book.name }}">
                            {% else %}
                            <div class="book-cover-placeholder">ğŸ“–</div>
                            {% endif %}
                        </div>

                        <div class="book-stat-info">
                            <h3>{{ stat.book.name }}</h3>
                            <div class="meta">
                                <span>ğŸ‘¥ {{ stat.reader_count }}ëª…</span>
                                <span>ğŸ§ {{ stat.book_duration }}</span>
                                <span>â±ï¸ {{ stat.total_listening_formatted }}</span>
                                <span>ğŸ“Š {{ stat.avg_progress_percent }}%</span>
                            </div>
                        </div>
                    </div>

                    <!-- ìƒíƒœ ë²„íŠ¼ -->
                    <div class="status-buttons" data-book-id="{{ stat.book.public_uuid }}">
                        <button class="status-btn" data-status="ongoing"
                            {% if stat.book.status == "ongoing" %}disabled{% endif %}>
                            ì—°ì¬ ì¤‘
                        </button>
                        <button class="status-btn" data-status="paused"
                            {% if stat.book.status == "paused" %}disabled{% endif %}>
                            íœ´ì¬
                        </button>
                        <button class="status-btn" data-status="ended"
                            {% if stat.book.status == "ended" %}disabled{% endif %}>
                            ì—°ì¬ ì¢…ë£Œ
                        </button>
                    </div>

                </div>
                {% endfor %}
            </div>
        </div>

        <script id="book-stats-data" type="application/json">
            {{ book_stats_json|safe }}
        </script>

        {% else %}
        <div class="empty-state">
            <h2>ì•„ì§ ì‘ì„±í•œ ì˜¤ë””ì˜¤ë¶ì´ ì—†ìŠµë‹ˆë‹¤</h2>
            <p>ì²« ì‘í’ˆì„ ë“±ë¡í•´ë³´ì„¸ìš”</p>
        </div>
        {% endif %}
    </div>

    <!-- ===================== -->
    <!-- AI ì†Œì„¤ íƒ­ -->
    <!-- ===================== -->
<div class="tab-content" id="tab-ai">

    {% if ai_stats %}
 <div class="stats-grid">

    <div class="stat-card">
        <div class="stat-card-header">
            <div class="stat-icon primary">ğŸ¤–</div>
        </div>
        <div class="stat-card-value">
            {{ ai_summary.total_llms }}
        </div>
        <div class="stat-card-title">ì´ AI ìˆ˜</div>
        <div class="stat-card-subtitle">ìƒì„±í•œ LLM ìºë¦­í„°</div>
    </div>

    <div class="stat-card">
        <div class="stat-card-header">
            <div class="stat-icon success">ğŸ‘¥</div>
        </div>
        <div class="stat-card-value">
            {{ ai_summary.total_ai_readers }}
        </div>
        <div class="stat-card-title">AI ë…ì ìˆ˜</div>
        <div class="stat-card-subtitle">ì¤‘ë³µ ì œê±° ê¸°ì¤€</div>
    </div>

    <div class="stat-card">
        <div class="stat-card-header">
            <div class="stat-icon warning">ğŸ§</div>
        </div>
        <div class="stat-card-value">
            {{ ai_summary.total_ai_tts_duration|floatformat:0 }}ì´ˆ
        </div>
        <div class="stat-card-title">ì´ AI ì˜¤ë””ì˜¤ ê¸¸ì´</div>
        <div class="stat-card-subtitle">ëª¨ë“  TTS í•©ê³„</div>
    </div>

    <div class="stat-card">
        <div class="stat-card-header">
            <div class="stat-icon info">â¤ï¸</div>
        </div>
        <div class="stat-card-value">
            {{ ai_summary.total_llm_likes }}
        </div>
        <div class="stat-card-title">AI ì¢‹ì•„ìš” ìˆ˜</div>
        <div class="stat-card-subtitle">ì „ì²´ LLM ê¸°ì¤€</div>
    </div>

</div>
    
    <div class="book-stats-section">
        <h2 class="section-title">AI ì†Œì„¤ í†µê³„</h2>

        <div class="book-stats-grid">
{% for stat in ai_stats %}
<div class="book-stat-card">

    <div class="book-stat-header">
        <div class="book-cover-mini">

            {% if stat.llm_image %}
                <img src="{{ stat.llm_image.url }}" alt="{{ stat.name }}">
            {% else %}
                <div class="intro-main-image-placeholder">ğŸ¤–</div>
            {% endif %}

        </div>

        <div class="book-stat-info">
            <h3>{{ stat.name }}</h3>

            {% if stat.story %}
                <div class="sub">{{ stat.story.title }}</div>
            {% endif %}

            <div class="meta">
                <span>ğŸ‘¥ {{ stat.reader_count }}ëª…</span>
                <span>â¤ï¸ {{ stat.like_count }}</span>
                <span>ğŸ§ {{ stat.total_tts_duration|floatformat:0 }}ì´ˆ</span>
            </div>
        </div>
    </div>

</div>
{% endfor %}
        </div>
    </div>
    {% else %}
    <div class="empty-state">
        <h2>AI ì†Œì„¤ì´ ì—†ìŠµë‹ˆë‹¤</h2>
        <p>AI ìºë¦­í„°ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”</p>
    </div>
    {% endif %}
</div>

</div>
{% endblock %}


{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<script src="{% static 'js/book/author_dashboard.js' %}"></script>
{% endblock %}
