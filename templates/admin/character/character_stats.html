{% extends "admin/base_site.html" %}
{% block title %}ìºë¦­í„° & TTS í†µê³„{% endblock %}

{% block extrastyle %}
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root {
  --bg:       #0d0d1a;
  --surface:  #16162a;
  --surface2: #1e1e35;
  --border:   #2a2a48;
  --violet:   #7c6ff7;
  --violet2:  #a89bfa;
  --teal:     #2dd4bf;
  --rose:     #fb7185;
  --amber:    #fbbf24;
  --green:    #34d399;
  --text:     #e8e8f8;
  --muted:    #7070a0;
  --radius:   14px;
  --mono:     'DM Mono', monospace;
}

* { box-sizing: border-box; }
body { background: var(--bg) !important; color: var(--text); font-family: 'Noto Sans KR', sans-serif; }
#content, .content { background: transparent !important; }
#content-main { padding: 0 !important; }

.dash-wrap { padding: 28px 24px 80px; max-width: 1280px; }

/* â”€â”€ í—¤ë” â”€â”€ */
.dash-head {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 28px;
  flex-wrap: wrap;
  gap: 14px;
}
.dash-head h1 {
  font-size: 1.6rem;
  font-weight: 900;
  color: var(--text);
  letter-spacing: -0.04em;
  margin: 0;
}
.dash-head h1 em { color: var(--violet2); font-style: normal; }

/* â”€â”€ ê¸°ê°„ ë²„íŠ¼ â”€â”€ */
.period-row { display: flex; gap: 6px; }
.pbtn {
  padding: 6px 16px; border-radius: 20px; font-size: 0.82rem; font-weight: 700;
  border: 1.5px solid var(--border); background: var(--surface2);
  color: var(--muted); cursor: pointer; text-decoration: none; transition: all 0.16s;
}
.pbtn:hover { border-color: var(--violet); color: var(--violet2); }
.pbtn.active { background: var(--violet); color: #fff; border-color: var(--violet); }

/* â”€â”€ ìš”ì•½ ì¹´ë“œ ê·¸ë¦¬ë“œ â”€â”€ */
.summary-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
  gap: 14px;
  margin-bottom: 32px;
}
.s-card {
  background: var(--surface);
  border: 1.5px solid var(--border);
  border-radius: var(--radius);
  padding: 20px 18px;
  position: relative;
  overflow: hidden;
  transition: border-color 0.2s;
}
.s-card:hover { border-color: var(--violet); }
.s-card::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 3px;
  border-radius: var(--radius) var(--radius) 0 0;
}
.s-card.violet::before { background: var(--violet); }
.s-card.teal::before   { background: var(--teal); }
.s-card.rose::before   { background: var(--rose); }
.s-card.amber::before  { background: var(--amber); }
.s-card.green::before  { background: var(--green); }

.s-card .icon { font-size: 1.5rem; margin-bottom: 10px; }
.s-card .val {
  font-size: 1.9rem; font-weight: 900;
  font-family: var(--mono);
  line-height: 1;
  color: var(--text);
}
.s-card .lbl { font-size: 0.74rem; color: var(--muted); margin-top: 6px; }

/* â”€â”€ ì„¹ì…˜ íƒ€ì´í‹€ â”€â”€ */
.sec-title {
  font-size: 0.95rem; font-weight: 800; color: var(--text);
  margin: 32px 0 14px;
  display: flex; align-items: center; gap: 8px;
  letter-spacing: -0.02em;
}
.sec-title::after {
  content: ''; flex: 1;
  height: 1px; background: var(--border);
}

/* â”€â”€ 2ë‹¨ ë ˆì´ì•„ì›ƒ â”€â”€ */
.two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
@media (max-width: 900px) { .two-col { grid-template-columns: 1fr; } }

/* â”€â”€ íŒ¨ë„ â”€â”€ */
.panel {
  background: var(--surface);
  border: 1.5px solid var(--border);
  border-radius: var(--radius);
  padding: 20px;
}
.panel-title { font-size: 0.82rem; font-weight: 700; color: var(--muted); margin-bottom: 16px; letter-spacing: 0.05em; text-transform: uppercase; }

/* â”€â”€ ë°” ì°¨íŠ¸ (ìˆœìˆ˜ CSS) â”€â”€ */
.bar-chart { display: flex; align-items: flex-end; gap: 5px; height: 100px; }
.bar-col { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 3px; height: 100%; justify-content: flex-end; }
.bar-fill {
  width: 100%; border-radius: 4px 4px 0 0;
  min-height: 2px;
  transition: height 0.4s cubic-bezier(0.34,1.56,0.64,1);
  position: relative;
}
.bar-fill:hover::after {
  content: attr(data-tip);
  position: absolute;
  bottom: calc(100% + 4px);
  left: 50%; transform: translateX(-50%);
  background: #000; color: #fff;
  font-size: 0.65rem; padding: 3px 7px; border-radius: 5px;
  white-space: nowrap; pointer-events: none; z-index: 10;
}
.bar-col .lbl { font-size: 0.58rem; color: var(--muted); writing-mode: vertical-rl; transform: rotate(180deg); white-space: nowrap; }
.violet-bar { background: linear-gradient(to top, #5a4ff0, #a89bfa); }
.teal-bar   { background: linear-gradient(to top, #0d9488, #2dd4bf); }

/* â”€â”€ ë­í¬ í…Œì´ë¸” â”€â”€ */
.rank-list { display: flex; flex-direction: column; gap: 8px; }
.rank-item {
  display: flex; align-items: center; gap: 12px;
  background: var(--surface2); border-radius: 10px;
  padding: 10px 14px; transition: background 0.15s;
}
.rank-item:hover { background: #252545; }
.rank-num {
  font-family: var(--mono); font-size: 0.78rem; font-weight: 700;
  color: var(--muted); width: 22px; text-align: center; flex-shrink: 0;
}
.rank-num.gold   { color: #fbbf24; }
.rank-num.silver { color: #c0c0d8; }
.rank-num.bronze { color: #cd7c3b; }

.rank-avatar {
  width: 38px; height: 38px; border-radius: 50%;
  object-fit: cover; flex-shrink: 0;
  border: 2px solid var(--border);
  background: var(--surface2);
}
.rank-avatar-ph {
  width: 38px; height: 38px; border-radius: 50%;
  background: linear-gradient(135deg, var(--violet), var(--teal));
  display: flex; align-items: center; justify-content: center;
  font-size: 1.1rem; flex-shrink: 0;
}
.rank-info { flex: 1; min-width: 0; }
.rank-name { font-size: 0.84rem; font-weight: 700; color: var(--text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.rank-sub  { font-size: 0.72rem; color: var(--muted); margin-top: 1px; }
.rank-val {
  font-family: var(--mono); font-size: 0.9rem; font-weight: 700;
  color: var(--violet2); white-space: nowrap;
}

/* â”€â”€ ìŠ¤í† ë¦¬ ì¹´ë“œ â”€â”€ */
.story-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 14px;
}
.story-card {
  background: var(--surface2);
  border: 1.5px solid var(--border);
  border-radius: 12px;
  overflow: hidden;
  transition: border-color 0.2s, transform 0.2s;
  cursor: default;
}
.story-card:hover { border-color: var(--violet); transform: translateY(-2px); }
.story-cover {
  width: 100%; height: 110px;
  object-fit: cover;
  background: linear-gradient(135deg, #1e1e40, #2e2e60);
}
.story-cover-ph {
  width: 100%; height: 110px;
  background: linear-gradient(135deg, #1e1e40, #3a3a70);
  display: flex; align-items: center; justify-content: center;
  font-size: 2rem;
}
.story-body { padding: 12px; }
.story-title { font-size: 0.82rem; font-weight: 700; color: var(--text); margin-bottom: 6px; line-height: 1.35; }
.story-meta { display: flex; gap: 10px; font-size: 0.72rem; color: var(--muted); }
.story-meta span { display: flex; align-items: center; gap: 3px; }

/* â”€â”€ ì‹ ê³  ë°°ì§€ â”€â”€ */
.report-row { display: flex; flex-direction: column; gap: 6px; }
.report-item {
  display: flex; align-items: center; gap: 10px;
  background: var(--surface2); border-radius: 8px; padding: 9px 14px;
}
.report-type { font-size: 0.8rem; font-weight: 700; color: var(--text); flex: 1; }
.report-bar-wrap { flex: 2; height: 6px; background: var(--border); border-radius: 3px; overflow: hidden; }
.report-bar-fill { height: 100%; background: var(--rose); border-radius: 3px; }
.report-cnt { font-family: var(--mono); font-size: 0.78rem; color: var(--rose); font-weight: 700; min-width: 30px; text-align: right; }

/* â”€â”€ TTS í‚¤ ë©”íŠ¸ë¦­ â”€â”€ */
.tts-metrics { display: flex; gap: 10px; margin-bottom: 18px; flex-wrap: wrap; }
.tts-pill {
  background: var(--surface2); border: 1.5px solid var(--border);
  border-radius: 20px; padding: 6px 14px;
  font-size: 0.78rem; font-weight: 700; color: var(--muted);
}
.tts-pill span { color: var(--violet2); font-family: var(--mono); }
</style>
{% endblock %}

{% block content %}
<div class="dash-wrap">

  <!-- â”€â”€ í—¤ë” â”€â”€ -->
  <div class="dash-head">
    <h1>ğŸ¤– ìºë¦­í„° <em>&</em> TTS í†µê³„</h1>
    <div class="period-row">
      {% for p, label in period_choices %}
      <a href="?period={{ p }}" class="pbtn {% if period == p %}active{% endif %}">{{ label }}</a>
      {% endfor %}
    </div>
  </div>

  <!-- â”€â”€ ìš”ì•½ ì¹´ë“œ â”€â”€ -->
  <div class="summary-grid">
    <div class="s-card violet">
      <div class="icon">ğŸ™</div>
      <div class="val">{{ tts_total_count|default:"0" }}</div>
      <div class="lbl">TTS ìƒì„± ê±´ìˆ˜</div>
    </div>
    <div class="s-card teal">
      <div class="icon">â±</div>
      <div class="val">{{ tts_total_minutes }}m</div>
      <div class="lbl">ì´ ìŒì„± ìƒì„± ì‹œê°„ ({{ tts_total_seconds }}ì´ˆ)</div>
    </div>
    <div class="s-card amber">
      <div class="icon">ğŸ¤–</div>
      <div class="val">{{ total_llms }}</div>
      <div class="lbl">ì „ì²´ AI ìºë¦­í„° ìˆ˜ (ê³µê°œ {{ total_public }})</div>
    </div>
    <div class="s-card green">
      <div class="icon">ğŸ’¬</div>
      <div class="val">{{ total_conv }}</div>
      <div class="lbl">ê¸°ê°„ ë‚´ ëŒ€í™” ì„¸ì…˜</div>
    </div>
    <div class="s-card violet">
      <div class="icon">ğŸ“–</div>
      <div class="val">{{ total_stories }}</div>
      <div class="lbl">ì „ì²´ ìŠ¤í† ë¦¬ ìˆ˜</div>
    </div>
    <div class="s-card rose">
      <div class="icon">ğŸš¨</div>
      <div class="val">{{ pending_reports }}</div>
      <div class="lbl">ë¯¸ì²˜ë¦¬ ì‹ ê³ </div>
    </div>
  </div>



  <!-- â”€â”€ ìºë¦­í„° ì¢‹ì•„ìš” + TTS ì´ˆ â”€â”€ -->
  <div class="sec-title">ğŸ¤– AI ìºë¦­í„° ìˆœìœ„</div>
  <div class="two-col">

    <!-- ì¢‹ì•„ìš” TOP 20 -->
    <div class="panel">
      <div class="panel-title">â¤ï¸ ìºë¦­í„°ë³„ ì¢‹ì•„ìš” TOP 20</div>
      <div class="rank-list">
        {% for llm in top_llm_likes %}
        <div class="rank-item">
          <div class="rank-num {% if forloop.counter == 1 %}gold{% elif forloop.counter == 2 %}silver{% elif forloop.counter == 3 %}bronze{% endif %}">
            {{ forloop.counter }}
          </div>
          {% if llm.llm_image %}
          <img class="rank-avatar" src="/media/{{ llm.llm_image }}" alt="">
          {% else %}
          <div class="rank-avatar-ph">ğŸ¤–</div>
          {% endif %}
          <div class="rank-info">
            <div class="rank-name">{{ llm.name }}</div>
            <div class="rank-sub">{% if llm.is_public %}ê³µê°œ{% else %}ë¹„ê³µê°œ{% endif %}</div>
          </div>
          <div class="rank-val">â™¥ {{ llm.like_cnt }}</div>
        </div>
        {% empty %}
        <div style="color:var(--muted);text-align:center;padding:20px;font-size:0.85rem;">ë°ì´í„° ì—†ìŒ</div>
        {% endfor %}
      </div>
    </div>

    <!-- ê¸°ê°„ ë‚´ TTS ìŒì„± ì´ˆ TOP -->
    <div class="panel">
      <div class="panel-title">ğŸ™ ìºë¦­í„°ë³„ TTS ìƒì„± ì´ˆ TOP 15 (ê¸°ê°„ ë‚´)</div>
      <div class="rank-list">
        {% for s in llm_tts_stats %}
        <div class="rank-item">
          <div class="rank-num {% if forloop.counter == 1 %}gold{% elif forloop.counter == 2 %}silver{% elif forloop.counter == 3 %}bronze{% endif %}">
            {{ forloop.counter }}
          </div>
          {% if s.conversation__llm__llm_image %}
          <img class="rank-avatar" src="/media/{{ s.conversation__llm__llm_image }}" alt="">
          {% else %}
          <div class="rank-avatar-ph">ğŸ™</div>
          {% endif %}
          <div class="rank-info">
            <div class="rank-name">{{ s.conversation__llm__name }}</div>
            <div class="rank-sub">{{ s.tts_count }}ê±´ ìƒì„±</div>
          </div>
          <div class="rank-val">{{ s.tts_seconds|floatformat:0 }}ì´ˆ</div>
        </div>
        {% empty %}
        <div style="color:var(--muted);text-align:center;padding:20px;font-size:0.85rem;">ë°ì´í„° ì—†ìŒ</div>
        {% endfor %}
      </div>
    </div>

  </div>

  <!-- â”€â”€ ê¸‰ìƒìŠ¹ ìºë¦­í„° â”€â”€ -->
  <div class="sec-title">ğŸš€ ê¸‰ìƒìŠ¹ ìºë¦­í„° (ê¸°ê°„ ë‚´ ìƒˆ ì¢‹ì•„ìš”)</div>
  <div class="panel">
    <div class="rank-list" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:8px;">
      {% for r in rising_llms %}
      <div class="rank-item">
        <div class="rank-num {% if forloop.counter == 1 %}gold{% elif forloop.counter == 2 %}silver{% elif forloop.counter == 3 %}bronze{% endif %}">
          {{ forloop.counter }}
        </div>
        {% if r.llm__llm_image %}
        <img class="rank-avatar" src="/media/{{ r.llm__llm_image }}" alt="">
        {% else %}
        <div class="rank-avatar-ph">âš¡</div>
        {% endif %}
        <div class="rank-info">
          <div class="rank-name">{{ r.llm__name }}</div>
          <div class="rank-sub">ê¸°ê°„ ë‚´ ì‹ ê·œ ì¢‹ì•„ìš”</div>
        </div>
        <div class="rank-val" style="color:var(--amber);">+{{ r.new_likes }}</div>
      </div>
      {% empty %}
      <div style="color:var(--muted);font-size:0.85rem;padding:12px;">ë°ì´í„° ì—†ìŒ</div>
      {% endfor %}
    </div>
  </div>

  <!-- â”€â”€ ì¸ê¸° ìŠ¤í† ë¦¬ â”€â”€ -->
  <div class="sec-title">ğŸ“– ì¸ê¸° ìŠ¤í† ë¦¬ TOP 10</div>
  <div class="story-grid">
    {% for st in top_stories %}
    <div class="story-card">
      {% if st.cover_image %}
      <img class="story-cover" src="/media/{{ st.cover_image }}" alt="{{ st.title }}">
      {% else %}
      <div class="story-cover-ph">ğŸ“–</div>
      {% endif %}
      <div class="story-body">
        <div class="story-title">{{ st.title }}</div>
        <div class="story-meta">
          <span>â™¥ {{ st.like_cnt }}</span>
          <span>ğŸ’¬ {{ st.comment_cnt }}</span>
          <span>ğŸ¤– {{ st.char_cnt }}</span>
        </div>
        <div style="margin-top:6px;font-size:0.68rem;color:var(--muted);">
          {% if st.is_public %}ğŸŒ ê³µê°œ{% else %}ğŸ”’ ë¹„ê³µê°œ{% endif %}
        </div>
      </div>
    </div>
    {% empty %}
    <div style="color:var(--muted);font-size:0.85rem;padding:12px;">ë°ì´í„° ì—†ìŒ</div>
    {% endfor %}
  </div>

  <!-- â”€â”€ ì‹ ê³  í˜„í™© â”€â”€ -->
  {% if report_by_type %}
  <div class="sec-title">ğŸš¨ ë¯¸ì²˜ë¦¬ ì‹ ê³  ìœ í˜•ë³„ í˜„í™©</div>
  <div class="panel" style="max-width:600px;">
    {% with max_report=report_by_type|dictsort:"cnt"|last %}
    <div class="report-row">
      {% for r in report_by_type %}
      {% widthratio r.cnt max_report.cnt 100 as bar_pct %}
      <div class="report-item">
        <div class="report-type">{{ r.content_type }}</div>
        <div class="report-bar-wrap">
          <div class="report-bar-fill" style="width:{{ bar_pct }}%;"></div>
        </div>
        <div class="report-cnt">{{ r.cnt }}</div>
      </div>
      {% endfor %}
    </div>
    {% endwith %}
  </div>
  {% endif %}

</div>
{% endblock %}