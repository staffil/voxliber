{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- SEO ë©”íƒ€ íƒœê·¸ -->
  <meta name="description" content="{% block meta_description %}VoxLiber - ì˜¤ë””ì˜¤ë¶ê³¼ ì˜¤ë””ì˜¤ ë“œë¼ë§ˆë¥¼ ë§Œë“¤ê³  ê³µìœ í•˜ëŠ” í”Œë«í¼{% endblock %}">
  <meta name="keywords" content="ì˜¤ë””ì˜¤ë¶, ì˜¤ë””ì˜¤ ë“œë¼ë§ˆ, ì›¹ì†Œì„¤, ë‚­ë…, TTS, {% block meta_keywords %}{% endblock %}">
  <meta name="author" content="VoxLiber">
  <meta name="robots" content="index, follow">
  <meta name="naver-site-verification" content="00bb847bef4f7c4d0c88efac7cf1c123d9a55514" />

  <!-- Canonical URL (ì¤‘ë³µ ì½˜í…ì¸  ë°©ì§€) -->
  <link rel="canonical" href="https://voxliber.ink{{ request.path }}">

  <!-- Open Graph (ì†Œì…œ ë¯¸ë””ì–´ ê³µìœ ) -->
  <meta property="og:title" content="{% block og_title %}{% block title %}VOXLIBER{% endblock %}{% endblock %}">
  <meta property="og:description" content="{% block og_description %}VoxLiber - ì˜¤ë””ì˜¤ë¶ê³¼ ì˜¤ë””ì˜¤ ë“œë¼ë§ˆë¥¼ ë§Œë“¤ê³  ê³µìœ í•˜ëŠ” í”Œë«í¼{% endblock %}">
  <meta property="og:image" content="{% block og_image %}{{ request.scheme }}://{{ request.get_host }}{% static 'img/voxliberMessage.jpg' %}?v=2{% endblock %}">
  <meta property="og:url" content="https://voxliber.ink{{ request.path }}">
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="VoxLiber">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="{% block twitter_title %}{% block page_title %}VOXLIBER{% endblock %}{% endblock %}">
  <meta name="twitter:description" content="{% block twitter_description %}VoxLiber - ì˜¤ë””ì˜¤ë¶ê³¼ ì˜¤ë””ì˜¤ ë“œë¼ë§ˆë¥¼ ë§Œë“¤ê³  ê³µìœ í•˜ëŠ” í”Œë«í¼{% endblock %}">
  <meta name="twitter:image" content="{% block twitter_image %}{{ request.scheme }}://{{ request.get_host }}{% static 'img/logo3.png' %}?v=2{% endblock %}">

  <title>{% block head_title %}VOXLIBER{% endblock %}</title>

  <!-- Favicon (ì—¬ëŸ¬ í¬ê¸° ì§€ì›) -->
  <link rel="icon" type="image/x-icon" href="{% static 'favicon.ico' %}">
  <link rel="icon" type="image/png" sizes="96x96" href="{% static 'img/favicon-96x96.png' %}">
  <link rel="icon" type="image/png" sizes="48x48" href="{% static 'img/logo4.png' %}">
  <link rel="icon" type="image/png" sizes="48x48" href="{% static 'img/favicon-48x48.png' %}">
  <link rel="icon" type="image/png" sizes="32x32" href="{% static 'img/favicon-32x32.png' %}">
  <link rel="icon" type="image/png" sizes="16x16" href="{% static 'img/favicon-16x16.png' %}">
  <link rel="apple-touch-icon" sizes="180x180" href="{% static 'img/logo3.png' %}">
  <link rel="shortcut icon" href="{% static 'favicon.ico' %}">
  <link rel="stylesheet" href="{% static 'css/common/variables.css' %}">
      <link rel="stylesheet" href="{% static 'css/common/appWarning.css' %}">

  {% block extra_css %}{% endblock %}
</head>
<body>

{% if user.is_authenticated %}
  <!-- ë¡œê·¸ì¸ ìƒíƒœ í—¤ë” -->
  <header>
    {% include "common/loginHeader.html" %}

  </header>
    <!-- Mobile Side Menu -->
  <div class="mobile-side-menu" id="mobileSideMenuGuest">
    <div class="mobile-menu-overlay" onclick="closeMobileMenu('Guest')"></div>
    <div class="mobile-menu-content">
      <div class="mobile-menu-header">
        <span class="menu-title">ë©”ë‰´</span>
        <button class="close-menu-btn" onclick="closeMobileMenu('Guest')">âœ•</button>
      </div>

            <!-- Mobile User Profile -->
            <div class="mobile-user-section">
                <a href="{% url 'mypage:my_profile' %}" class="mobile-user-profile">
                    {% if user.user_img %}
                        <img src="{{ user.user_img.url }}" alt="í”„ë¡œí•„" class="mobile-profile-img">
                    {% else %}
                        <img src="{% static 'img/default-avatar.png' %}" alt="í”„ë¡œí•„" class="mobile-profile-img">
                    {% endif %}
                    <div class="mobile-user-info">
                        <div class="mobile-username">{{ user.nickname|default:user.email|default:"ì‚¬ìš©ì" }}</div>
                        <div class="mobile-profile-link">ë§ˆì´í˜ì´ì§€ â†’</div>
                    </div>
                </a>
            </div>

            <nav class="mobile-nav">

                <a href="/book/book-snap/" class="mobile-nav-item">
                    <span class="nav-icon">ğŸ“¸</span>
                    <span>SNAP</span>
                </a>

                <a href="/mypage/library/" class="mobile-nav-item">
                    <span class="nav-icon">ğŸ“š</span>
                    <span>ë‚´ ì„œì œ</span>
                </a>
                <a href="{% url 'book:my_bookmarks' %}" class="mobile-nav-item">
                    <span class="nav-icon">ğŸ”–</span>
                    <span>ë¶ë§ˆí¬</span>
                </a>
                <a href="my/book/list/" class="mobile-nav-item">
                    <span class="nav-icon">ğŸ“•</span>
                    <span>ë¶ ë¦¬ìŠ¤íŠ¸</span>
                </a>


                <div class="mobile-menu-divider"></div>
                <a href="{% url 'register:logout' %}" class="mobile-nav-item mobile-logout-btn">
                    <span class="nav-icon">ğŸšª</span>
                    <span>ë¡œê·¸ì•„ì›ƒ</span>
                </a>

            </nav>
        </div>
    </div>

{% else %}
  <!-- ë¹„ë¡œê·¸ì¸ ìƒíƒœ í—¤ë” -->
  <header>
    {% include "common/notLoginHeader.html" %}

  </header>

  <!-- ë¹„ë¡œê·¸ì¸ ìƒíƒœ ëª¨ë°”ì¼ ë©”ë‰´ -->
  <div class="mobile-side-menu" id="mobileSideMenuGuest">
    <div class="mobile-menu-overlay" onclick="closeMobileMenu('Guest')"></div>
    <div class="mobile-menu-content">
      <div class="mobile-menu-header">
        <span class="menu-title">ë©”ë‰´</span>
        <button class="close-menu-btn" onclick="closeMobileMenu('Guest')">âœ•</button>
      </div>
      <nav class="mobile-nav">

        <div class="mobile-menu-divider"></div>
        <button class="mobile-nav-item mobile-login-btn" onclick="openLogin()">ğŸ”‘ ë¡œê·¸ì¸</button>
      </nav>
    </div>
  </div>
{% endif %}

{% if show_login_card %}
    <div class="login-overlay">
        <div class="login-card">
            <h2>ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</h2>
            <p>ì½˜í…ì¸ ë¥¼ ë³´ë ¤ë©´ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.</p>
            <a href="{% url 'login' %}?next={{ request.path }}" class="login-btn">ë¡œê·¸ì¸</a>
            <button onclick="closeLoginCard()">ë‚˜ì¤‘ì—</button>  <!-- ì¹´ë“œ ë‹«ê¸° -->
        </div>
    </div>
    <div id="global-blur-overlay">
  <div class="blur-blocker"></div>
</div>
    {% endif %}


<!-- í˜ì´ì§€ ì»¨í…ì¸  -->
{% block content %}{% endblock %}
<script src="{% static 'js/common/login_btn.js' %}"></script>
<!-- <script src="{% static 'js/common/appWarning.js' %}"></script> -->
<script>
  window.IS_AUTHENTICATED = {{ request.user.is_authenticated|yesno:"true,false" }};
</script>


<!-- ê³µí†µ JS -->
<script>
console.log(`
     @@@@@    #####                            @@@@@@    
    @@@@@@@  #######                          @@@@@@@@      
   @@@@@@@@@##########                       @@@@@@@@@       
   @@@@@@@@@@##########                     @@@@@@@@@@     
    @@@@@@@@@@##########                   @@@@@@@@@@      
     @@@@@@@@@@##########                 @@@@@@@@@@       
      @@@@@@@@@@##########               @@@@@@@@@@        
       @@@@@@@@@@##########             @@@@@@@@@@         
        @@@@@@@@@@##########           @@@@@@@@@@          
         @@@@@@@@@@##########         @@@@@@@@@@           
          @@@@@@@@@@##########       @@@@@@@@@@            
           @@@@@@@@@@##########     @@@@@@@@@@             
            @@@@@@@@@@##########   @@@@@@@@@@              
             @@@@@@@@@@########## @@@@@@@@@@               
              @@@@@@@@@@#########@@@@@@@@@@                
               @@@@@@@@@@#######@@@@@@@@@@                 
                @@@@@@@@@@#####@@@@@@@@@@                  
                 @@@@@@@@@@###@@@@@@@@@@                   
                  @@@@@@@@@@#@@@@@@@@@@                    
                   @@@@@@@@@@@@@@@@@@@#                    
                    @@@@@@@@@@@@@@@@@###
                     @@@@@@@@@@@@@@@#####                    
                      @@@@@@@@@@@@@#######    ######################                             
                       @@@@@@@@@@@#######    ########################
                        @@@@@@@@@ ######    ##########################
                         @@@@@@@   ####      ########################
                          @@@@@     ##        ######################
  `, 
);

  function notLogin() {
    alert("ë¡œê·¸ì¸ì„ ë¨¼ì € í•´ì£¼ì„¸ìš”.");
    openLogin();
  }

  function toggleTheme() {
    const isLight = document.body.classList.toggle('light-mode');
    localStorage.setItem('theme', isLight ? 'light' : 'dark');
    const themeToggle = document.getElementById('themeToggle');
    if (themeToggle) themeToggle.textContent = isLight ? 'â˜€ï¸' : 'ğŸŒ™';
  }

  (function() {
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'light') document.body.classList.add('light-mode');
  })();

  function toggleMobileMenu(type) {
    const menuId = type === 'Logged' ? 'mobileSideMenuLogged' : 'mobileSideMenuGuest';
    const menu = document.getElementById(menuId);
    if (!menu) return; // ë©”ë‰´ê°€ ì—†ìœ¼ë©´ ê·¸ëƒ¥ ì¢…ë£Œ
    menu.classList.toggle('active');
    document.body.style.overflow = menu.classList.contains('active') ? 'hidden' : '';
  }

  function closeMobileMenu(type) {
    const menuId = type === 'Logged' ? 'mobileSideMenuLogged' : 'mobileSideMenuGuest';
    const menu = document.getElementById(menuId);
    menu.classList.remove('active');
    document.body.style.overflow = '';
  }

  // âœ… ì´ë¯¸ì§€ Lazy Loading (ì„±ëŠ¥ ìµœì í™”)
  document.addEventListener('DOMContentLoaded', function() {
    const lazyImages = document.querySelectorAll('img[loading="lazy"]');

    if ('IntersectionObserver' in window) {
      const imageObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const img = entry.target;
            // data-srcê°€ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ê·¸ëƒ¥ ë¡œë“œ
            if (img.dataset.src) {
              img.src = img.dataset.src;
            }
            img.classList.add('lazy-loaded');
            observer.unobserve(img);
          }
        });
      }, {
        rootMargin: '50px' // 50px ë¯¸ë¦¬ ë¡œë“œ
      });

      lazyImages.forEach(img => imageObserver.observe(img));
    }
  });


  document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll('[data-login-required]').forEach(btn => {
    btn.addEventListener("click", e => {
      if (!window.IS_AUTHENTICATED) {
        e.preventDefault();
        openLogin(); // ë„¤ê°€ ì´ë¯¸ ë§Œë“  ë¡œê·¸ì¸ ì¹´ë“œ / ëª¨ë‹¬
      }
    });
  });
  
});

if (!window.IS_AUTHENTICATED) {
  document.addEventListener("DOMContentLoaded", () => {
    // ëª¨ë“  ì…ë ¥ ìš”ì†Œ ì„ íƒ
    const inputs = document.querySelectorAll(
      "input, textarea, select, [contenteditable]"
    );

    inputs.forEach(el => {
      // í¬ì»¤ìŠ¤ ìì²´ ì œê±°
      el.blur();

      // ì…ë ¥ ì°¨ë‹¨
      el.setAttribute("disabled", "disabled");

      // contenteditable ëŒ€ì‘
      if (el.hasAttribute("contenteditable")) {
        el.setAttribute("contenteditable", "false");
      }
    });
  });
}
</script>

{% block extra_js %}{% endblock %}
</body>
</html>
