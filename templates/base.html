{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- SEO ë©”íƒ€ íƒœê·¸ -->
  <meta name="description" content="{% block meta_description %}VoxLiber - ì˜¤ë””ì˜¤ë¶ê³¼ ì˜¤ë””ì˜¤ ë“œë¼ë§ˆë¥¼ ë§Œë“¤ê³  ê³µìœ í•˜ëŠ” í”Œë«í¼{% endblock %}">
  <meta name="keywords" content="ì˜¤ë””ì˜¤ë¶, ì˜¤ë””ì˜¤ ë“œë¼ë§ˆ, ì›¹ì†Œì„¤, ë‚­ë…, TTS, {% block meta_keywords %}{% endblock %}">
  <meta name="author" content="VoxLiber">
  <meta name="robots" content="index, follow">

  <!-- Open Graph (ì†Œì…œ ë¯¸ë””ì–´ ê³µìœ ) -->
  <meta property="og:title" content="{% block og_title %}{% block title %}VOXLIBER{% endblock %}{% endblock %}">
  <meta property="og:description" content="{% block og_description %}VoxLiber - ì˜¤ë””ì˜¤ë¶ê³¼ ì˜¤ë””ì˜¤ ë“œë¼ë§ˆë¥¼ ë§Œë“¤ê³  ê³µìœ í•˜ëŠ” í”Œë«í¼{% endblock %}">
  <meta property="og:image" content="{% block og_image %}{{ request.scheme }}://{{ request.get_host }}{% static 'img/logo3.png' %}{% endblock %}">
  <meta property="og:url" content="{{ request.build_absolute_uri }}">
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="VoxLiber">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="{% block twitter_title %}{% block page_title %}VOXLIBER{% endblock %}{% endblock %}">
  <meta name="twitter:description" content="{% block twitter_description %}VoxLiber - ì˜¤ë””ì˜¤ë¶ê³¼ ì˜¤ë””ì˜¤ ë“œë¼ë§ˆë¥¼ ë§Œë“¤ê³  ê³µìœ í•˜ëŠ” í”Œë«í¼{% endblock %}">
  <meta name="twitter:image" content="{% block twitter_image %}{{ request.scheme }}://{{ request.get_host }}{% static 'img/logo3.png' %}{% endblock %}">

  <title>{% block head_title %}VOXLIBER{% endblock %}</title>

  <link rel="icon" type="image/png" href="{% static 'img/logo3.png' %}">
  <link rel="apple-touch-icon" href="{% static 'img/logo3.png' %}">
  <link rel="stylesheet" href="{% static 'css/common/variables.css' %}">
  {% block extra_css %}{% endblock %}
</head>
<body>

{% if user.is_authenticated %}
  <!-- ë¡œê·¸ì¸ ìƒíƒœ í—¤ë” -->
  <header>
    {% include "common/loginHeader.html" %}

  </header>
    <!-- Mobile Side Menu -->
  <div class="mobile-side-menu" id="mobileSideMenuGuest">
    <div class="mobile-menu-overlay" onclick="closeMobileMenu('Guest')"></div>
    <div class="mobile-menu-content">
      <div class="mobile-menu-header">
        <span class="menu-title">ë©”ë‰´</span>
        <button class="close-menu-btn" onclick="closeMobileMenu('Guest')">âœ•</button>
      </div>

            <!-- Mobile User Profile -->
            <div class="mobile-user-section">
                <a href="{% url 'mypage:my_profile' %}" class="mobile-user-profile">
                    {% if user.user_img %}
                        <img src="{{ user.user_img.url }}" alt="í”„ë¡œí•„" class="mobile-profile-img">
                    {% else %}
                        <img src="{% static 'img/default-avatar.png' %}" alt="í”„ë¡œí•„" class="mobile-profile-img">
                    {% endif %}
                    <div class="mobile-user-info">
                        <div class="mobile-username">{{ user.nickname|default:user.email|default:"ì‚¬ìš©ì" }}</div>
                        <div class="mobile-profile-link">ë§ˆì´í˜ì´ì§€ â†’</div>
                    </div>
                </a>
            </div>

            <nav class="mobile-nav">
                <a href="{% url 'book:book_tos' %}" class="mobile-nav-item">
                    <span class="nav-icon">ğŸ“</span>
                    <span>ì´ì•¼ê¸° ë§Œë“¤ê¸°</span>
                </a>
                <a href="/book/book-snap/" class="mobile-nav-item">
                    <span class="nav-icon">ğŸ“¸</span>
                    <span>SNAP</span>
                </a>
                <a href="/book/author-dashboard/" class="mobile-nav-item">
                    <span class="nav-icon">âœï¸</span>
                    <span>ì‘ê°€ ì„¼í„°</span>
                </a>
                <a href="/mypage/library/" class="mobile-nav-item">
                    <span class="nav-icon">ğŸ“š</span>
                    <span>ë‚´ ì„œì œ</span>
                </a>
                <div class="mobile-menu-divider"></div>
                <a href="{% url 'register:logout' %}" class="mobile-nav-item mobile-logout-btn">
                    <span class="nav-icon">ğŸšª</span>
                    <span>ë¡œê·¸ì•„ì›ƒ</span>
                </a>

            </nav>
        </div>
    </div>

{% else %}
  <!-- ë¹„ë¡œê·¸ì¸ ìƒíƒœ í—¤ë” -->
  <header>
    {% include "common/notLoginHeader.html" %}

  </header>

  <!-- ë¹„ë¡œê·¸ì¸ ìƒíƒœ ëª¨ë°”ì¼ ë©”ë‰´ -->
  <div class="mobile-side-menu" id="mobileSideMenuGuest">
    <div class="mobile-menu-overlay" onclick="closeMobileMenu('Guest')"></div>
    <div class="mobile-menu-content">
      <div class="mobile-menu-header">
        <span class="menu-title">ë©”ë‰´</span>
        <button class="close-menu-btn" onclick="closeMobileMenu('Guest')">âœ•</button>
      </div>
      <nav class="mobile-nav">
        <a href="#" class="mobile-nav-item" onclick="notLogin()">ğŸ“ ì´ì•¼ê¸° ë§Œë“¤ê¸°</a>
        <a href="/book/book-snap/" class="mobile-nav-item">ğŸ“¸ SNAP</a>
        <a href="#" class="mobile-nav-item">âœï¸ ì‘ê°€ ì„¼í„°</a>
        <div class="mobile-menu-divider"></div>
        <button class="mobile-nav-item mobile-login-btn" onclick="openLogin()">ğŸ”‘ ë¡œê·¸ì¸</button>
      </nav>
    </div>
  </div>
{% endif %}

<!-- í˜ì´ì§€ ì»¨í…ì¸  -->
{% block content %}{% endblock %}

<!-- ê³µí†µ JS -->
<script>
  function notLogin() {
    alert("ë¡œê·¸ì¸ì„ ë¨¼ì € í•´ì£¼ì„¸ìš”.");
    openLogin();
  }

  function toggleTheme() {
    const isLight = document.body.classList.toggle('light-mode');
    localStorage.setItem('theme', isLight ? 'light' : 'dark');
    const themeToggle = document.getElementById('themeToggle');
    if (themeToggle) themeToggle.textContent = isLight ? 'â˜€ï¸' : 'ğŸŒ™';
  }

  (function() {
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'light') document.body.classList.add('light-mode');
  })();

  function toggleMobileMenu(type) {
    const menuId = type === 'Logged' ? 'mobileSideMenuLogged' : 'mobileSideMenuGuest';
    const menu = document.getElementById(menuId);
    if (!menu) return; // ë©”ë‰´ê°€ ì—†ìœ¼ë©´ ê·¸ëƒ¥ ì¢…ë£Œ
    menu.classList.toggle('active');
    document.body.style.overflow = menu.classList.contains('active') ? 'hidden' : '';
  }

  function closeMobileMenu(type) {
    const menuId = type === 'Logged' ? 'mobileSideMenuLogged' : 'mobileSideMenuGuest';
    const menu = document.getElementById(menuId);
    menu.classList.remove('active');
    document.body.style.overflow = '';
  }

  // âœ… ì´ë¯¸ì§€ Lazy Loading (ì„±ëŠ¥ ìµœì í™”)
  document.addEventListener('DOMContentLoaded', function() {
    const lazyImages = document.querySelectorAll('img[loading="lazy"]');

    if ('IntersectionObserver' in window) {
      const imageObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const img = entry.target;
            // data-srcê°€ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ê·¸ëƒ¥ ë¡œë“œ
            if (img.dataset.src) {
              img.src = img.dataset.src;
            }
            img.classList.add('lazy-loaded');
            observer.unobserve(img);
          }
        });
      }, {
        rootMargin: '50px' // 50px ë¯¸ë¦¬ ë¡œë“œ
      });

      lazyImages.forEach(img => imageObserver.observe(img));
    }
  });
</script>

{% block extra_js %}{% endblock %}
</body>
</html>
