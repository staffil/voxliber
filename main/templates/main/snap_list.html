{% extends "base.html" %}
{% load static %}

{% block title %}SNAP - VOXLIBER{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/home/main/snap.css' %}">
<link rel="stylesheet" href="{% static 'css/home/main/snap_list.css' %}">

{% endblock %}

{% block content %}
<div class="snap-list-container">
    <div class="snap-list-header">
        <h1>ğŸ“¸ SNAP</h1>
        <p>ì§§ê³  ê°•ë ¬í•œ ë¶ìŠ¤ëƒ…ì„ ë§Œë‚˜ë³´ì„¸ìš”</p>
    </div>

    <div class="snap-grid">
        {% for snap in snap_list %}
        <div class="snap-grid-item">
            <a href="{% url 'book:book_snap_detail' snap.public_uuid %}" data-login-required>
                <div class="snap-media-wrapper">
                    <!-- ì„¬ë„¤ì¼ ì´ë¯¸ì§€ -->
                    {% if snap.thumbnail %}
                    <img class="snap-thumbnail"
                         src="{{ snap.thumbnail.url }}"
                         alt="{{ snap.snap_title }}"
                         loading="lazy">
                    {% else %}
                    <img class="snap-thumbnail"
                         src="{% static 'images/book_snap_placeholder.png' %}"
                         alt="{{ snap.snap_title }}"
                         loading="lazy">
                    {% endif %}

                    <!-- ì˜ìƒ (í˜¸ë²„ ì‹œ ì¬ìƒ) -->
                    {% if snap.snap_video %}
                    <video class="hover-video"
                           muted
                           loop
                           playsinline
                           preload="none"
                           data-src="{{ snap.snap_video.url }}">
                    </video>
                    {% endif %}

                    <!-- ì˜¤ë²„ë ˆì´ -->
                    <div class="snap-overlay">
                        <h3>{{ snap.snap_title|default:"ì œëª© ì—†ìŒ" }}</h3>
                        <div class="snap-meta">
                            {% if snap.user %}
                            <span>{{ snap.user.nickname }}</span>
                            {% endif %}
                            {% if snap.view_count %}
                            <span>ğŸ‘ {{ snap.view_count }}</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </a>
        </div>
        {% empty %}
        <div style="grid-column: 1 / -1; text-align: center; padding: 60px 20px; color: rgba(255,255,255,0.6);">
            <div style="font-size: 64px; margin-bottom: 16px;">ğŸ“¸</div>
            <p style="font-size: 18px; color: #fff; margin-bottom: 8px;">ì•„ì§ SNAPì´ ì—†ìŠµë‹ˆë‹¤</p>
            <p style="font-size: 14px;">ì²« ë²ˆì§¸ SNAPì„ ë§Œë“¤ì–´ë³´ì„¸ìš”!</p>
        </div>
        {% endfor %}
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // ë¹„ë””ì˜¤ í˜¸ë²„ ì¬ìƒ
    const snapItems = document.querySelectorAll('.snap-grid-item');

    snapItems.forEach(item => {
        const video = item.querySelector('.hover-video');
        if (!video) return;

        item.addEventListener('mouseenter', function() {
            // lazy load video src
            if (!video.src && video.dataset.src) {
                video.src = video.dataset.src;
            }
            video.currentTime = 0;
            video.play().catch(() => {});
        });

        item.addEventListener('mouseleave', function() {
            video.pause();
            video.currentTime = 0;
        });
    });
});
</script>
{% endblock %}
